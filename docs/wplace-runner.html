<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>WPlace Runner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:24px;background:#0b0b0c;color:#eaeaea}
    .card{max-width:840px;margin:auto;background:#151618;border:1px solid #2a2c2f;border-radius:16px;padding:20px}
    h1{margin-top:0}
    input,button{font:inherit}
    input[type=url]{width:100%;padding:10px;border-radius:10px;border:1px solid #3a3d41;background:#0f1012;color:#eee}
    button{margin-top:12px;padding:10px 14px;border:1px solid #3a3d41;border-radius:10px;background:#1d2024;color:#fff;cursor:pointer}
    .log{margin-top:16px;font-size:13px;white-space:pre-wrap;background:#0f1012;border:1px solid #3a3d41;border-radius:10px;padding:12px}
  </style>
</head>
<body>
  <div class="card">
    <h1>WPlace Runner</h1>
    <p>Carga y ejecuta un script remoto (raw) fuera de la CSP del sitio original.</p>
    <label>URL del script:</label>
    <input id="src" type="url" placeholder="https://raw.githubusercontent.com/.../Auto-My-Addon.js" />
    <button id="run">Ejecutar</button>
    <div class="log" id="log"></div>
  </div>
<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const log = (m)=>{$('#log').textContent += m + '\n'};

  const qs = new URLSearchParams(location.search);
  if(qs.get('src')) $('#src').value = qs.get('src');

  async function run() {
    const url = $('#src').value.trim();
    if(!url) return alert('Pon una URL válida');
    log('Descargando: '+url);
    const r = await fetch(url,{cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const code = await r.text();
    log('Tamaño: ' + code.length + ' bytes');
    try {
      new Function(code + '\n//# sourceURL=remote-bot.js')();
      log('OK: ejecutado con new Function');
    } catch (e) {
      log('new Function falló: ' + e.message);
      const blob = new Blob([code],{type:'text/javascript'});
      const src = URL.createObjectURL(blob);
      await new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.onload=()=>{log('OK: ejecutado con <script src=blob:>');res()};
        s.onerror=()=>rej(new Error('Fallo al cargar blob URL'));
        s.src=src;document.body.appendChild(s);
      });
    }
  }

  $('#run').onclick = ()=>run().catch(e=>log('ERROR: '+e.message));
  if(qs.get('src')) $('#run').click(); // auto-run si viene por query
})();
</script>
</body>
</html>
